<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat de Cuidados - MVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 20px;
        }
        .chat-bubble-bot {
            background-color: #F3F4F6; /* gray-100 */
            color: #1F2937; /* gray-800 */
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }
        .chat-bubble-user {
            background-color: #3B82F6; /* blue-500 */
            color: #FFFFFF;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
        }
        .chat-bubble-file {
            background-color: #E0E7FF; /* indigo-100 */
            border: 1px solid #C7D2FE; /* indigo-200 */
            color: #3730A3; /* indigo-800 */
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }
        .chat-action-button {
            border: 1px solid #3B82F6; /* blue-500 */
            color: #3B82F6; /* blue-500 */
            background-color: #FFFFFF;
            transition: all 0.2s ease-in-out;
        }
        .chat-action-button:hover {
            background-color: #EFF6FF; /* blue-50 */
        }
        .fade-in-up {
            animation: fadeInUp 0.5s ease-in-out forwards;
            opacity: 0;
            transform: translateY(15px);
        }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md mx-auto bg-white rounded-2xl shadow-2xl flex flex-col h-[90vh] sm:h-[80vh]">
        <!-- Cabe√ßalho do Chat -->
        <header class="bg-blue-600 text-white p-4 rounded-t-2xl flex items-center shadow-md z-10">
            <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center mr-4">
                <svg class="w-7 h-7 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            </div>
            <div>
                <h1 class="text-lg font-semibold">Nina - Assistente de Cuidados</h1>
                <p class="text-sm opacity-80">Online</p>
            </div>
        </header>

        <!-- Corpo do Chat -->
        <main id="chat-window" class="flex-1 p-6 overflow-y-auto flex flex-col space-y-4">
            <!-- As mensagens do chat ser√£o inseridas aqui -->
        </main>

        <!-- √Årea de A√ß√µes -->
        <footer id="chat-actions-container" class="p-4 border-t border-gray-200 bg-white rounded-b-2xl">
             <div class="flex items-center">
                <div id="chat-actions" class="flex-grow"></div>
                <button onclick="simulateFileUpload()" title="Anexar arquivo" class="ml-2 p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path></svg>
                </button>
            </div>
        </footer>
    </div>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const chatActions = document.getElementById('chat-actions');
        let conversationState = 'start';

        const conversationFlow = {
            'start': {
                messages: [
                    { delay: 500, content: 'Ol√°, Ana Paula! Sou a Nina, sua assistente virtual de cuidados da Dra. Helena. üòä' },
                    { delay: 1200, content: 'Tenho √≥timas not√≠cias! Seu novo plano de cuidados j√° est√° pronto e eu vou te ajudar a organizar tudo.' },
                    { 
                        delay: 1500, 
                        content: 'Dra. Helena prescreveu uma f√≥rmula para a pele e solicitou um exame de sangue. Vamos come√ßar pelos medicamentos?',
                        actions: [{ text: 'Sim, vamos l√°!', nextState: 'showQuotes' }]
                    }
                ]
            },
            'showQuotes': {
                userResponse: 'Sim, vamos l√°!',
                messages: [
                    { delay: 1000, content: 'Perfeito! Para sua f√≥rmula, j√° fiz uma cota√ß√£o em 2 farm√°cias parceiras. Veja os valores:<br><br>üíä <b>Farm√°cia A:</b> R$ 112,50 (Entrega em 2 dias)<br>üíä <b>Farm√°cia B:</b> R$ 105,00 (Entrega em 3 dias)' },
                    { 
                        delay: 1200, 
                        content: 'Qual delas voc√™ prefere? √â s√≥ tocar na op√ß√£o que eu confirmo o pedido para voc√™.',
                        actions: [
                            { text: 'Escolher Farm√°cia A', nextState: 'pharmacyChosen' },
                            { text: 'Escolher Farm√°cia B', nextState: 'pharmacyChosen' }
                        ]
                    }
                ]
            },
            'pharmacyChosen': {
                userResponse: (actionText) => actionText,
                messages: [
                    { delay: 1000, content: '√ìtima escolha! Pedido confirmado. ‚úÖ<br>Agora, sobre o seu exame de sangue...' },
                    { delay: 1500, content: 'J√° encontrei o melhor hor√°rio para voc√™ no <b>Laborat√≥rio Vida</b>: üóìÔ∏è <b>15 de Setembro de 2025, √†s 8h</b>.<br><br>‚ö†Ô∏è <b>Preparo:</b> √â necess√°rio jejum absoluto de 8 horas.' },
                    { 
                        delay: 1200, 
                        content: 'Fica bom para voc√™?',
                        actions: [{ text: 'Confirmar Agendamento', nextState: 'examConfirmed' }]
                    }
                ]
            },
            'examConfirmed': {
                userResponse: 'Confirmar Agendamento',
                messages: [
                    { delay: 1000, content: 'Agendado com sucesso! ‚úÖ' },
                    { delay: 1200, content: 'N√£o se preocupe, vou te enviar um lembrete na v√©spera do exame.'},
                    { 
                        delay: 1500, 
                        content: 'Ah, e a Dra. Helena j√° me enviou o resultado do seu √∫ltimo hemograma. Quer dar uma olhada ou prefere enviar um exame antigo para a doutora?',
                        actions: [
                            { text: 'Ver resultado agora', nextState: 'showResults' },
                            { text: 'Enviar um exame antigo', nextState: 'uploadFilePrompt' }
                        ]
                    }
                ]
            },
            'showResults': {
                userResponse: 'Ver resultado agora',
                messages: [
                    { delay: 1000, content: 'Claro. Aqui est√° o arquivo que a Dra. enviou:' },
                    { delay: 500, type: 'file', fileName: 'Hemograma_Completo_Ana_Paula.pdf' },
                    { 
                        delay: 1200, 
                        content: 'Os principais pontos est√£o dentro da normalidade. Voc√™ gostaria que eu explicasse algum item espec√≠fico?',
                        actions: [
                            { text: 'O que s√£o Hem√°cias?', nextState: 'explainHemacias' },
                            { text: 'E os Leuc√≥citos?', nextState: 'explainLeucocitos' },
                            { text: 'Plaquetas est√£o ok?', nextState: 'explainPlaquetas' },
                        ]
                    }
                ]
            },
            'explainHemacias': {
                userResponse: 'O que s√£o Hem√°cias?',
                messages: [
                    { delay: 1000, content: 'As <b>Hem√°cias</b> (gl√≥bulos vermelhos) transportam oxig√™nio pelo corpo. Seu resultado de <b>4.5 milh√µes/¬µL</b> est√° √≥timo, dentro da refer√™ncia (4.0 - 5.2). Isso indica uma boa oxigena√ß√£o! üëç' },
                    { 
                        delay: 1200, 
                        content: 'Quer saber sobre outro item?',
                        actions: [
                            { text: 'Sim, sobre Leuc√≥citos', nextState: 'explainLeucocitos' },
                            { text: 'E as Plaquetas?', nextState: 'explainPlaquetas' },
                            { text: 'N√£o, obrigado(a)', nextState: 'endConversation' }
                        ]
                    }
                ]
            },
            'explainLeucocitos': {
                userResponse: (actionText) => actionText.includes('Leuc√≥citos') ? actionText : 'E os Leuc√≥citos?',
                messages: [
                    { delay: 1000, content: 'Os <b>Leuc√≥citos</b> (gl√≥bulos brancos) s√£o as c√©lulas de defesa do seu corpo. Seu resultado de <b>6.500/mm¬≥</b> est√° excelente, dentro do esperado (4.000 - 11.000). Significa que sua imunidade est√° forte! üí™' },
                     { 
                        delay: 1200, 
                        content: 'Posso ajudar com mais alguma d√∫vida?',
                        actions: [
                            { text: 'O que s√£o Hem√°cias?', nextState: 'explainHemacias' },
                            { text: 'E as Plaquetas?', nextState: 'explainPlaquetas' },
                            { text: 'N√£o, obrigado(a)', nextState: 'endConversation' }
                        ]
                    }
                ]
            },
            'explainPlaquetas': {
                userResponse: (actionText) => actionText.includes('Plaquetas') ? actionText : 'E as Plaquetas?',
                messages: [
                    { delay: 1000, content: 'As <b>Plaquetas</b> s√£o respons√°veis pela coagula√ß√£o do sangue, ajudando a parar sangramentos. Seu resultado de <b>250.000/¬µL</b> est√° perfeito, dentro da normalidade (150.000 - 450.000). Tudo certo com sua cicatriza√ß√£o! ‚ú®' },
                     { 
                        delay: 1200, 
                        content: 'Quer esclarecer mais algum ponto?',
                        actions: [
                            { text: 'O que s√£o Hem√°cias?', nextState: 'explainHemacias' },
                            { text: 'Sim, sobre Leuc√≥citos', nextState: 'explainLeucocitos' },
                            { text: 'N√£o, obrigado(a)', nextState: 'endConversation' }
                        ]
                    }
                ]
            },
            'uploadFilePrompt': {
                userResponse: 'Enviar um exame antigo',
                messages: [
                    { delay: 1000, content: 'Claro. Por favor, use o √≠cone üìé para anexar o arquivo que deseja enviar para a Dra. Helena.' }
                ]
            },
            'fileUploaded': {
                userResponse: (actionText) => `[Arquivo enviado: ${actionText}]`,
                 messages: [
                    { delay: 1500, content: 'Recebido! Enviando para a Dra. Helena...' },
                    { delay: 1200, content: 'Prontinho! A doutora foi notificada e ver√° seu exame em breve. ‚úÖ' },
                    { 
                        delay: 1200, 
                        content: 'Posso te ajudar em algo mais?',
                        actions: [
                             { text: 'Ver resultado do hemograma', nextState: 'showResults' },
                             { text: 'N√£o, por enquanto √© s√≥', nextState: 'endConversation' }
                        ]
                    }
                ]
            },
            'endConversation': {
                userResponse: (actionText) => actionText,
                messages: [
                    { delay: 1000, content: 'Combinado! Se precisar de algo mais, √© s√≥ me chamar. Estou sempre por aqui. üòâ' }
                ]
            }
        };

        function addMessage(sender, content, type = 'text') {
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble fade-in-up ${sender === 'bot' ? 'chat-bubble-bot' : 'chat-bubble-user'}`;
            
            if (type === 'file') {
                 bubble.classList.add('chat-bubble-file');
                 bubble.innerHTML = `<svg class="w-6 h-6 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg> <span>${content}</span>`;
            } else {
                bubble.innerHTML = content;
            }
            
            chatWindow.appendChild(bubble);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function renderActions(actions) {
            chatActions.innerHTML = '';
            if (!actions) return;

            const buttonsWrapper = document.createElement('div');
            buttonsWrapper.className = 'flex flex-wrap gap-2 justify-center';
            
            actions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'text-center p-3 rounded-lg chat-action-button font-semibold flex-grow';
                button.innerText = action.text;
                button.onclick = () => handleAction(action);
                buttonsWrapper.appendChild(button);
            });
            chatActions.appendChild(buttonsWrapper);
        }

        function playConversation(state) {
            const flow = conversationFlow[state];
            if (!flow) return;

            let messageQueue = [...flow.messages];

            function next() {
                if (messageQueue.length === 0) {
                    renderActions(flow.actions);
                    return;
                }
                const messageData = messageQueue.shift();
                setTimeout(() => {
                    addMessage('bot', messageData.content, messageData.type);
                    if (messageQueue.length === 0) {
                        renderActions(messageData.actions);
                    } else {
                        next();
                    }
                }, messageData.delay || 0);
            }
            next();
        }

        function handleAction(action) {
            const currentState = conversationFlow[conversationState];
            const userResponseText = typeof currentState.userResponse === 'function' 
                ? currentState.userResponse(action.text) 
                : action.text;

            addMessage('user', userResponseText);
            
            conversationState = action.nextState;
            chatActions.innerHTML = ''; 
            playConversation(conversationState);
        }
        
        function simulateFileUpload() {
            // Simula a escolha de um arquivo e o envio
            const fileName = "Exame_Pele_2024.pdf";
            addMessage('user', `[Arquivo enviado: ${fileName}]`, 'file');
            conversationState = 'fileUploaded';
            chatActions.innerHTML = '';
            playConversation(conversationState);
        }

        document.addEventListener('DOMContentLoaded', () => {
            playConversation('start');
        });
    </script>
</body>
</html>

